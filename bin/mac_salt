#!/bin/bash

OUTPUT='--state-output=changes'
if [[ $@ == *"--verbose"* ]]; then
  OUTPUT='--state-output=full --log-level=info'
fi

MACSALT=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )

function help_function () {
	echo -e "
options:

alias
bootstrap
doctor
function
help
source
update

do:
	update

go:
	big

pillar:
	raw

state:
	highstate
	sls <sls>


If you are running into issues running mac_salt then you should try running: 'mac_salt' doctor to see if there are any issues with the setup.
"
}

ARGS=`echo $@ | sed -e 's/--verbose//g'`

case $ARGS in
	alias|aliases)
		echo -e "aliases:"
		cat ~/.mac_salt/aliases | grep "^alias" | awk '{ $1=""; print $0 }' | sort -n 
		echo -e "\nprofile:"
		cat ~/.mac_salt/profile | grep "^alias" | awk '{ $1=""; print $0 }' | sort -n
		;;
	bootstrap)
		$MACSALT/../bootstrap.sh
		;;
	doctor)
		$MACSALT/ms_doctor.sh
		;;
	function|functions)
		echo -e "\ncpdm:"
		cat ~/.mac_salt/cpdm | grep "^##" | awk '{ $1=""; print $0 }' | grep -v '^-' | sort -n
		echo -e "functions:"
		cat ~/.mac_salt/functions | grep "^##" | awk '{ $1=""; print $0 }' | grep -v '^-' | sort -n
		echo -e "\nhistory:"
		cat ~/.mac_salt/history | grep "^##" | awk '{ $1=""; print $0 }' | grep -v '^-' | sort -n
		echo -e "\ngit_functions:"
		cat ~/.mac_salt/git_functions | grep "^##" | awk '{ $1=""; print $0 }' | grep -v '^-' | sort -n
		echo -e "\nprofile:"
		cat ~/.mac_salt/profile | grep "^##" | awk '{ $1=""; print $0 }' | grep -v '^-' | sort -n
		;;
	help)
		help_function
		;;
	source)
		echo -e "source ~/.mac_salt/bash_config" | tr -d '\n' | pbcopy
		echo -e "paste clipboard into terminal."
		;;
	update)
		cd $MACSALT/..
		git pull
		;;
	state.*|do.*|pillar.*|go.*)
		$MACSALT/grains.sh
		OPTIONS="--local --file-root=$MACSALT/../salt --pillar-root=$MACSALT/../pillar"
		# echo "sudo -H -E salt-call $OPTIONS $OUTPUT $ARGS"
		sudo -H -E salt-call $OPTIONS $OUTPUT $ARGS
		;;
	*)
		echo "Did not find a matching option."
		help_function
esac